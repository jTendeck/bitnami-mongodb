
#######################
#######################
#######################
#######################
# !!
# DO NOT EDIT!!
# !!
# THIS IS GENERATED - SEE .github/job-docker-image.py
# !!
#######################
#######################
#######################
#######################
name: Dockerfiles

on:
  push:
    branches: [ main ]

env:
  BUILD_ALL: 'NO'
  REGISTRY: https://ghcr.io
  REGISTRY_USERNAME: ${{ secrets.CONTAINER_REGISTRY_USERNAME }}
  REGISTRY_PASSWORD: ${{ secrets.CONTAINER_REGISTRY_PASSWORD }}

jobs:
  mongodb:
    env:
      DOCKER_ITEM: mongodb
      PREFIX: 6.0-
    name: mongodb image
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - id: slug
      name: Get short SHA
      run: echo "::set-output name=sha8::$(echo ${GITHUB_SHA} | cut -c1-8)"
    - name: Login to DockerHub
      uses: docker/login-action@v1
      with:
        password: ${{ env.REGISTRY_PASSWORD }}
        registry: ${{ env.REGISTRY }}
        username: ${{ env.REGISTRY_USERNAME }}
    - uses: actions/cache@v2
      with:
        key: ${{ runner.os }}-buildx-${{ github.sha }}
        path: /tmp/.buildx-cache
        restore-keys: ${{ runner.os }}-buildx-
    - id: buildx
      name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v1
    - id: meta
      name: Docker meta
      uses: crazy-max/ghaction-docker-meta@v1
      with:
        images: ${{ env.REGISTRY }}/jTendeck/bitnami-mongodb/${{env.DOCKER_ITEM}}
    - name: Build image
      uses: docker/build-push-action@v5
      with:
        build-args: GITHUB_API_TOKEN=${{ secrets.CONTAINER_REGISTRY_PASSWORD }}
        cache-from: type=local,src=/tmp/.buildx-cache
        cache-to: type=local,dest=/tmp/.buildx-cache
        context: .
        file: mongodb/6.0/debian-11/Dockerfile
        load: true
        tags: jTendeck/bitnami-mongodb:${{ env.PREFIX }}${{ steps.slug.outputs.sha8 }}
